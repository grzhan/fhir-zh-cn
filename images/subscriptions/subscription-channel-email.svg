<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="821px" preserveAspectRatio="none" style="width:714px;height:821px;background:#FFFFFF;" version="1.1" viewBox="0 0 714 821" width="714px" zoomAndPan="magnify"><defs><filter height="300%" id="f1s6nk67n5ldkd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1s6nk67n5ldkd)" height="400.2031" style="stroke:#000000;stroke-width:2.0;" width="690" x="10" y="77.5938"/><rect fill="#FFFFFF" height="92.0703" style="stroke:none;stroke-width:1.0;" width="690" x="10" y="146.9922"/><rect fill="#FFFFFF" height="238.7344" style="stroke:none;stroke-width:1.0;" width="690" x="10" y="239.0625"/><rect fill="#FFFFFF" filter="url(#f1s6nk67n5ldkd)" height="249.5391" style="stroke:#000000;stroke-width:2.0;" width="690" x="10" y="491.7969"/><rect fill="#FFFFFF" height="114.2031" style="stroke:none;stroke-width:1.0;" width="690" x="10" y="512.9297"/><rect fill="#FFFFFF" height="114.2031" style="stroke:none;stroke-width:1.0;" width="690" x="10" y="627.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="60.5938" y2="387.5313"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="387.5313" y2="419.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="419.5313" y2="595.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="595.1328" y2="627.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="627.1328" y2="709.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="709.3359" y2="741.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="741.3359" y2="758.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="60.5938" y2="387.5313"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="395" x2="395" y1="387.5313" y2="419.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="419.5313" y2="595.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="395" x2="395" y1="595.1328" y2="627.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="627.1328" y2="709.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="395" x2="395" y1="709.3359" y2="741.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="741.3359" y2="758.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="583" x2="583" y1="60.5938" y2="387.5313"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="583" x2="583" y1="387.5313" y2="419.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="583" x2="583" y1="419.5313" y2="595.1328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="583" x2="583" y1="595.1328" y2="627.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="583" x2="583" y1="627.1328" y2="709.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="583" x2="583" y1="709.3359" y2="741.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="583" x2="583" y1="741.3359" y2="758.3359"/><rect fill="#FEFECE" filter="url(#f1s6nk67n5ldkd)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="97" x="60" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="69" y="26.9951">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="77.5" y="43.292">REST API</text><rect fill="#FEFECE" filter="url(#f1s6nk67n5ldkd)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="97" x="60" y="757.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="69" y="779.3311">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="77.5" y="795.6279">REST API</text><rect fill="#FEFECE" filter="url(#f1s6nk67n5ldkd)" height="34.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="365" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="374" y="43.292">Client</text><rect fill="#FEFECE" filter="url(#f1s6nk67n5ldkd)" height="34.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="365" y="757.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="374" y="779.3311">Client</text><rect fill="#FEFECE" filter="url(#f1s6nk67n5ldkd)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="130" x="516" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="539" y="26.9951">Email Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="525" y="43.292">(SMTP/S, Direct)</text><rect fill="#FEFECE" filter="url(#f1s6nk67n5ldkd)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="130" x="516" y="757.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="539" y="779.3311">Email Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="525" y="795.6279">(SMTP/S, Direct)</text><path d="M10,77.5938 L257,77.5938 L257,88.5938 L247,98.5938 L10,98.5938 L10,77.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="400.2031" style="stroke:#000000;stroke-width:2.0;" width="690" x="10" y="77.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="198" x="27" y="92.6606">Negotiating a Subscription</text><polygon fill="#A80036" points="121.5,134.9922,111.5,138.9922,121.5,142.9922,117.5,138.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="115.5" x2="394.5" y1="138.9922" y2="138.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="124.3599">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="146.5" y="116.7935">Create Subscription</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="146.5" y="131.9263">channelType: email</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="700" y1="147.9922" y2="147.9922"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="135" x="17" y="160.2026">[Without handshake]</text><polygon fill="#A80036" points="383.5,202.0625,393.5,206.0625,383.5,210.0625,387.5,206.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="389.5" y1="206.0625" y2="206.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="191.4302">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="136.5" y="183.8638">Success</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="136.5" y="198.9966">Subscription.status: active</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="700" y1="240.0625" y2="240.0625"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114" x="17" y="252.2729">[With handshake]</text><polygon fill="#A80036" points="383.5,294.1328,393.5,298.1328,383.5,302.1328,387.5,298.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="389.5" y1="298.1328" y2="298.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="283.5005">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="136.5" y="275.9341">Success</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="136.5" y="291.0669">Subscription.status: requested</text><polygon fill="#A80036" points="571,327.2656,581,331.2656,571,335.2656,575,331.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="577" y1="331.2656" y2="331.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="324.1997">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="136.5" y="324.1997">Message with verification, opt-in, opt-out, etc.</text><polygon fill="#A80036" points="121.5,375.5313,111.5,379.5313,121.5,383.5313,117.5,379.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="115.5" x2="582" y1="379.5313" y2="379.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="364.8989">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="146.5" y="357.3325">SMTP Success, e.g.:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="146.5" y="372.4653">250: OK</text><path d="M115,424.5313 L115,468.5313 L356,468.5313 L356,434.5313 L346,424.5313 L115,424.5313 " fill="#FBFB77" filter="url(#f1s6nk67n5ldkd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M346,424.5313 L346,434.5313 L356,434.5313 L346,424.5313 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="123" y="443.5981">Server updates Subscription:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="123" y="458.731">Subscription.status: active</text><path d="M10,491.7969 L282,491.7969 L282,502.7969 L272,512.7969 L10,512.7969 L10,491.7969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="249.5391" style="stroke:#000000;stroke-width:2.0;" width="690" x="10" y="491.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223" x="27" y="506.8638">Email Subscription Processing</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="700" y1="513.9297" y2="513.9297"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="17" y="526.1401">[Server sends heartbeat]</text><polygon fill="#A80036" points="571,583.1328,581,587.1328,571,591.1328,575,587.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="577" y1="587.1328" y2="587.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="564.9341">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="136.5" y="549.8013">Message with readable content and attached Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="232.5" y="564.9341">Bundle.type: history</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="136.5" y="580.0669">SubscriptionStatus.type: heartbeat</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="700" y1="628.1328" y2="628.1328"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="212" x="17" y="640.3433">[Server sends event-notification]</text><polygon fill="#A80036" points="571,697.3359,581,701.3359,571,705.3359,575,701.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="577" y1="701.3359" y2="701.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="679.1372">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="136.5" y="664.0044">Message with readable content and attached Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="232.5" y="679.1372">Bundle.type: history</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="344" x="136.5" y="694.27">SubscriptionStatus.type: event-notification</text><!--MD5=[bca4dbdb9e39cd000036930b9843b04c]
@startuml
skinparam NoteTextAlignment left
skinparam Padding 2
skinparam ParticipantPadding 40
skinparam LifelineStrategy solid
autonumber

participant "FHIR Server\nREST API"     as S
participant "Client"                    as C
participant "Email Server\n(SMTP/S, Direct)" as E


group Negotiating a Subscription
  C->S: Create Subscription\n""channelType: email""
else Without handshake
  S- ->C: Success\n""Subscription.status: active""
  |||
else With handshake
  S- ->C: Success\n""Subscription.status: requested""

  S->E: Message with verification, opt-in, opt-out, etc.
  return SMTP Success, e.g.:\n""250: OK""

  ...

  note right of S
    Server updates Subscription:
    ""Subscription.status: active""
  end note

end

group Email Subscription Processing
else Server sends heartbeat
    S->E: Message with readable content and attached Bundle:\n""            Bundle.type: history""\n""SubscriptionStatus.type: heartbeat""
    ...
else Server sends event-notification
    S->E: Message with readable content and attached Bundle:\n""            Bundle.type: history""\n""SubscriptionStatus.type: event-notification""
    ...
end
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>