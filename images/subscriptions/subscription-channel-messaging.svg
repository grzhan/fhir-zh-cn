<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="896px" preserveAspectRatio="none" style="width:724px;height:896px;background:#FFFFFF;" version="1.1" viewBox="0 0 724 896" width="724px" zoomAndPan="magnify"><defs><filter height="300%" id="frv69kv6ukkpy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#frv69kv6ukkpy)" height="317.8594" style="stroke:#000000;stroke-width:2.0;" width="700" x="10" y="77.5938"/><rect fill="#FFFFFF" filter="url(#frv69kv6ukkpy)" height="406.6016" style="stroke:#000000;stroke-width:2.0;" width="700" x="10" y="409.4531"/><rect fill="#FFFFFF" height="192.7344" style="stroke:none;stroke-width:1.0;" width="700" x="10" y="430.5859"/><rect fill="#FFFFFF" height="192.7344" style="stroke:none;stroke-width:1.0;" width="700" x="10" y="623.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="60.5938" y2="591.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="591.3203" y2="623.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="623.3203" y2="784.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="784.0547" y2="816.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="816.0547" y2="833.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="60.5938" y2="591.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="395" x2="395" y1="591.3203" y2="623.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="623.3203" y2="784.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="395" x2="395" y1="784.0547" y2="816.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="395" x2="395" y1="816.0547" y2="833.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="60.5938" y2="591.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="588" x2="588" y1="591.3203" y2="623.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="623.3203" y2="784.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="588" x2="588" y1="784.0547" y2="816.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="588" x2="588" y1="816.0547" y2="833.0547"/><rect fill="#FEFECE" filter="url(#frv69kv6ukkpy)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="97" x="60" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="69" y="26.9951">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="77.5" y="43.292">REST API</text><rect fill="#FEFECE" filter="url(#frv69kv6ukkpy)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="97" x="60" y="832.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="69" y="854.0498">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="77.5" y="870.3467">REST API</text><rect fill="#FEFECE" filter="url(#frv69kv6ukkpy)" height="34.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="365" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="374" y="43.292">Client</text><rect fill="#FEFECE" filter="url(#frv69kv6ukkpy)" height="34.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="365" y="832.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="374" y="854.0498">Client</text><rect fill="#FEFECE" filter="url(#frv69kv6ukkpy)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="140" x="516" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="525" y="26.9951">Client FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="534.5" y="43.292">REST Endpoint</text><rect fill="#FEFECE" filter="url(#frv69kv6ukkpy)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="140" x="516" y="832.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="525" y="854.0498">Client FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="534.5" y="870.3467">REST Endpoint</text><path d="M10,77.5938 L242,77.5938 L242,88.5938 L232,98.5938 L10,98.5938 L10,77.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="317.8594" style="stroke:#000000;stroke-width:2.0;" width="700" x="10" y="77.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="27" y="92.6606">Subscription Negotiation</text><polygon fill="#A80036" points="121.5,134.9922,111.5,138.9922,121.5,142.9922,117.5,138.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="115.5" x2="394.5" y1="138.9922" y2="138.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="124.3599">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="146.5" y="116.7935">Create Subscription</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="146.5" y="131.9263">channelType: message</text><polygon fill="#A80036" points="383.5,183.2578,393.5,187.2578,383.5,191.2578,387.5,187.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="389.5" y1="187.2578" y2="187.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="172.6255">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="136.5" y="165.0591">Success</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="240" x="136.5" y="180.1919">Subscription.status: requested</text><line style="stroke:#A80036;stroke-width:1.0;" x1="586" x2="576" y1="280.9219" y2="276.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="586" x2="576" y1="280.9219" y2="284.9219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="587" y1="280.9219" y2="280.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="243.5903">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="136.5" y="213.3247">POST</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="174.5" y="213.3247">$process-message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="306.5" y="213.3247">(handshake)</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="136.5" y="228.4575">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="152.5" y="243.5903">Bundle.type: message</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="344" x="152.5" y="258.7231">entry[1]: Bundle: subscription-notification</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="168.5" y="273.856">SubscriptionStatus.type: handshake</text><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="120.5" y1="329.1875" y2="325.1875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="120.5" y1="329.1875" y2="333.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="587" y1="329.1875" y2="329.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="314.5552">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="146.5" y="306.9888">Success, e.g.:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="146.5" y="322.1216">200: OK</text><path d="M115,342.1875 L115,386.1875 L356,386.1875 L356,352.1875 L346,342.1875 L115,342.1875 " fill="#FBFB77" filter="url(#frv69kv6ukkpy)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M346,342.1875 L346,352.1875 L356,352.1875 L346,342.1875 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="123" y="361.2544">Server updates Subscription:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="123" y="376.3872">Subscription.status: active</text><path d="M10,409.4531 L361,409.4531 L361,420.4531 L351,430.4531 L10,430.4531 L10,409.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="406.6016" style="stroke:#000000;stroke-width:2.0;" width="700" x="10" y="409.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="302" x="27" y="424.52">FHIR Messaging Subscription Processing</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="710" y1="431.5859" y2="431.5859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="17" y="443.7964">[Server sends heartbeat]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="586" x2="576" y1="535.0547" y2="531.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="586" x2="576" y1="535.0547" y2="539.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="587" y1="535.0547" y2="535.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="497.7231">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="136.5" y="467.4575">POST</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="174.5" y="467.4575">$process-message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="306.5" y="467.4575">(heartbeat)</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="136.5" y="482.5903">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="152.5" y="497.7231">Bundle.type: message</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="344" x="152.5" y="512.856">entry[1]: Bundle: subscription-notification</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="168.5" y="527.9888">SubscriptionStatus.type: heartbeat</text><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="120.5" y1="583.3203" y2="579.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="120.5" y1="583.3203" y2="587.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="587" y1="583.3203" y2="583.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="568.688">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="146.5" y="561.1216">Success, e.g.:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="146.5" y="576.2544">200: OK</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="710" y1="624.3203" y2="624.3203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="212" x="17" y="636.5308">[Server sends event-notification]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="586" x2="576" y1="727.7891" y2="723.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="586" x2="576" y1="727.7891" y2="731.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="587" y1="727.7891" y2="727.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="690.4575">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="136.5" y="660.1919">POST</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="174.5" y="660.1919">$process-message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="306.5" y="660.1919">(event-notification)</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="136.5" y="675.3247">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="152.5" y="690.4575">Bundle.type: message</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="344" x="152.5" y="705.5903">entry[1]: Bundle: subscription-notification</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="344" x="168.5" y="720.7231">SubscriptionStatus.type: event-notification</text><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="120.5" y1="776.0547" y2="772.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110.5" x2="120.5" y1="776.0547" y2="780.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="587" y1="776.0547" y2="776.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="761.4224">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="146.5" y="753.856">Success, e.g.:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="146.5" y="768.9888">200: OK</text><!--MD5=[424398167fb4ff5ae329bd060f4c5033]
@startuml
skinparam NoteTextAlignment left
skinparam Padding 2
skinparam ParticipantPadding 40
skinparam LifelineStrategy solid
autonumber

participant "FHIR Server\nREST API"     as S
participant "Client"                    as C
participant "Client FHIR Server\nREST Endpoint" as E

group Subscription Negotiation
  C->S: Create Subscription\n""channelType: message""
  return Success\n""Subscription.status: requested""

  S->>E: POST ""$process-message"" (handshake)\n""Bundle:""\n""  Bundle.type: message""\n""  entry[1]: Bundle: subscription-notification""\n""    SubscriptionStatus.type: handshake""
  return Success, e.g.:\n""200: OK""

  note right of S
    Server updates Subscription:
    ""Subscription.status: active""
  end note

end

group FHIR Messaging Subscription Processing
else Server sends heartbeat
  S->>E: POST ""$process-message"" (heartbeat)\n""Bundle:""\n""  Bundle.type: message""\n""  entry[1]: Bundle: subscription-notification""\n""    SubscriptionStatus.type: heartbeat""
  return Success, e.g.:\n""200: OK""
  ...
else Server sends event-notification
  S->>E: POST ""$process-message"" (event-notification)\n""Bundle:""\n""  Bundle.type: message""\n""  entry[1]: Bundle: subscription-notification""\n""    SubscriptionStatus.type: event-notification""
  return Success, e.g.:\n""200: OK""
  ...
end
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>