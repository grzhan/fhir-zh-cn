<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1204px" preserveAspectRatio="none" style="width:1068px;height:1204px;background:#FFFFFF;" version="1.1" viewBox="0 0 1068 1204" width="1068px" zoomAndPan="magnify"><defs><filter height="300%" id="fy36cnlqep87o" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fy36cnlqep87o)" height="117.6641" style="stroke:#000000;stroke-width:2.0;" width="603" x="10" y="77.5938"/><rect fill="#FFFFFF" filter="url(#fy36cnlqep87o)" height="914.2734" style="stroke:#000000;stroke-width:2.0;" width="1044.5" x="10" y="209.2578"/><rect fill="#FFFFFF" height="290.3984" style="stroke:none;stroke-width:1.0;" width="1044.5" x="10" y="230.3906"/><rect fill="#FFFFFF" height="114.2031" style="stroke:none;stroke-width:1.0;" width="1044.5" x="10" y="520.7891"/><rect fill="#FFFFFF" height="114.2031" style="stroke:none;stroke-width:1.0;" width="1044.5" x="10" y="634.9922"/><rect fill="#FFFFFF" height="322.3984" style="stroke:none;stroke-width:1.0;" width="1044.5" x="10" y="749.1953"/><rect fill="#FFFFFF" height="51.9375" style="stroke:none;stroke-width:1.0;" width="1044.5" x="10" y="1071.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="60.5938" y2="602.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="602.9922" y2="634.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="634.9922" y2="717.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="717.1953" y2="749.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="749.1953" y2="1039.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="110" x2="110" y1="1039.5938" y2="1071.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="110" x2="110" y1="1071.5938" y2="1140.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="60.5938" y2="602.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="532" x2="532" y1="602.9922" y2="634.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="634.9922" y2="717.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="532" x2="532" y1="717.1953" y2="749.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="749.1953" y2="1039.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="532" x2="532" y1="1039.5938" y2="1071.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="1071.5938" y2="1140.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921.5" x2="921.5" y1="60.5938" y2="602.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="921.5" x2="921.5" y1="602.9922" y2="634.9922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921.5" x2="921.5" y1="634.9922" y2="717.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="921.5" x2="921.5" y1="717.1953" y2="749.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921.5" x2="921.5" y1="749.1953" y2="1039.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="921.5" x2="921.5" y1="1039.5938" y2="1071.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="921.5" x2="921.5" y1="1071.5938" y2="1140.5313"/><rect fill="#FEFECE" filter="url(#fy36cnlqep87o)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="97" x="60" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="69" y="26.9951">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="77.5" y="43.292">REST API</text><rect fill="#FEFECE" filter="url(#fy36cnlqep87o)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="97" x="60" y="1139.5313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="69" y="1161.5264">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="77.5" y="1177.8232">REST API</text><rect fill="#FEFECE" filter="url(#fy36cnlqep87o)" height="34.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="502" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="511" y="43.292">Client</text><rect fill="#FEFECE" filter="url(#fy36cnlqep87o)" height="34.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="502" y="1139.5313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="511" y="1161.5264">Client</text><rect fill="#FEFECE" filter="url(#fy36cnlqep87o)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="162" x="838.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="880" y="26.9951">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="847.5" y="43.292">Websocket Endpoint</text><rect fill="#FEFECE" filter="url(#fy36cnlqep87o)" height="50.5938" style="stroke:#A80036;stroke-width:1.5;" width="162" x="838.5" y="1139.5313"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="880" y="1161.5264">FHIR Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="847.5" y="1177.8232">Websocket Endpoint</text><path d="M10,77.5938 L242,77.5938 L242,88.5938 L232,98.5938 L10,98.5938 L10,77.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="117.6641" style="stroke:#000000;stroke-width:2.0;" width="603" x="10" y="77.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="183" x="27" y="92.6606">Subscription Negotiation</text><polygon fill="#A80036" points="121.5,134.9922,111.5,138.9922,121.5,142.9922,117.5,138.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="115.5" x2="531.5" y1="138.9922" y2="138.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="124.3599">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="146.5" y="116.7935">Create Subscription</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="146.5" y="131.9263">channelType: websocket</text><polygon fill="#A80036" points="520.5,183.2578,530.5,187.2578,520.5,191.2578,524.5,187.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="526.5" y1="187.2578" y2="187.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="172.6255">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="136.5" y="165.0591">Success</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="136.5" y="180.1919">Subscription.status: active</text><path d="M10,209.2578 L324,209.2578 L324,220.2578 L314,230.2578 L10,230.2578 L10,209.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="914.2734" style="stroke:#000000;stroke-width:2.0;" width="1044.5" x="10" y="209.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="265" x="27" y="224.3247">Websocket Subscription Processing</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1054.5" y1="231.3906" y2="231.3906"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="191" x="17" y="243.6011">[Client binds via initial token]</text><polygon fill="#A80036" points="121.5,285.4609,111.5,289.4609,121.5,293.4609,117.5,289.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="115.5" x2="531.5" y1="289.4609" y2="289.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="129.5" y="274.8286">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="146.5" y="267.2622">FHIR Operation:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="368" x="146.5" y="282.395">.../Subscription/example/$get-ws-binding-token</text><polygon fill="#A80036" points="520.5,363.9922,530.5,367.9922,520.5,371.9922,524.5,367.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="526.5" y1="367.9922" y2="367.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="119.5" y="338.2271">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="136.5" y="315.5278">FHIR Parameters:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="200.5" y="330.6606">token: token-abc</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="264" x="160.5" y="345.7935">expiration: some-future-date-time</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="328" x="136.5" y="360.9263">websocket-url: wss://example.org/fhirWss</text><polygon fill="#A80036" points="909.5,412.2578,919.5,416.2578,909.5,420.2578,913.5,416.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="915.5" y1="416.2578" y2="416.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="541.5" y="401.6255">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="558.5" y="394.0591">Connect</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="558.5" y="409.1919">wss://example.org/fhirWss</text><polygon fill="#A80036" points="909.5,445.3906,919.5,449.3906,909.5,453.3906,913.5,449.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="915.5" y1="449.3906" y2="449.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="541.5" y="442.3247">6</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="558.5" y="442.3247">bind-with-token: token-abc</text><polygon fill="#A80036" points="543.5,508.7891,533.5,512.7891,543.5,516.7891,539.5,512.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="537.5" x2="920.5" y1="512.7891" y2="512.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="551.5" y="490.5903">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="568.5" y="475.4575">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="664.5" y="490.5903">Bundle.type: history</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="568.5" y="505.7231">SubscriptionStatus.type: handshake</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1054.5" y1="521.7891" y2="521.7891"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="155" x="17" y="533.9995">[Sever sends heartbeat]</text><polygon fill="#A80036" points="543.5,590.9922,533.5,594.9922,543.5,598.9922,539.5,594.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="920.5" y1="594.9922" y2="594.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="551.5" y="572.7935">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="568.5" y="557.6606">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="664.5" y="572.7935">Bundle.type: history</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="568.5" y="587.9263">SubscriptionStatus.type: heartbeat</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1054.5" y1="635.9922" y2="635.9922"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="212" x="17" y="648.2026">[Server sends event-notification]</text><polygon fill="#A80036" points="543.5,705.1953,533.5,709.1953,543.5,713.1953,539.5,709.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="920.5" y1="709.1953" y2="709.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="551.5" y="686.9966">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="568.5" y="671.8638">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="664.5" y="686.9966">Bundle.type: history</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="344" x="568.5" y="702.1294">SubscriptionStatus.type: event-notification</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1054.5" y1="750.1953" y2="750.1953"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="155" x="17" y="762.4058">[Token is expiring soon]</text><polygon fill="#A80036" points="121.5,804.2656,111.5,808.2656,121.5,812.2656,117.5,808.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="115.5" x2="531.5" y1="808.2656" y2="808.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="129.5" y="793.6333">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="155.5" y="786.0669">FHIR Operation:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="368" x="155.5" y="801.1997">.../Subscription/example/$get-ws-binding-token</text><polygon fill="#A80036" points="520.5,882.7969,530.5,886.7969,520.5,890.7969,524.5,886.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="526.5" y1="886.7969" y2="886.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="119.5" y="857.0317">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="145.5" y="834.3325">FHIR Parameters:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="209.5" y="849.4653">token: token-def</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="288" x="169.5" y="864.5981">expiration: another-future-date-time</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="328" x="145.5" y="879.731">websocket-url: wss://example.org/fhirWss</text><ellipse cx="532" cy="934.3125" rx="4" ry="4" style="stroke:#A80036;stroke-width:1.5;fill:none;"/><ellipse cx="921" cy="934.3125" rx="4" ry="4" style="stroke:#A80036;stroke-width:1.5;fill:none;"/><polygon fill="#A80036" points="904,931.0625,914,935.0625,904,939.0625,908,935.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536.5" x2="910" y1="935.0625" y2="935.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="541.5" y="920.4302">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="567.5" y="912.8638">Client checks the url and establishes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="567.5" y="927.9966">a new connection if necessary</text><polygon fill="#A80036" points="909.5,964.1953,919.5,968.1953,909.5,972.1953,913.5,968.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="915.5" y1="968.1953" y2="968.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="541.5" y="961.1294">13</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="567.5" y="961.1294">bind-with-token: token-def</text><polygon fill="#A80036" points="543.5,1027.5938,533.5,1031.5938,543.5,1035.5938,539.5,1031.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="537.5" x2="920.5" y1="1031.5938" y2="1031.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="551.5" y="1009.395">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="577.5" y="994.2622">Bundle:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="673.5" y="1009.395">Bundle.type: history</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="577.5" y="1024.5278">SubscriptionStatus.type: handshake</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1054.5" y1="1072.5938" y2="1072.5938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="220" x="17" y="1084.8042">[Either system may end a session]</text><line style="stroke:#A80036;stroke-width:2.0;" x1="538.5" x2="548.5" y1="1110.5313" y2="1120.5313"/><line style="stroke:#A80036;stroke-width:2.0;" x1="538.5" x2="548.5" y1="1120.5313" y2="1110.5313"/><line style="stroke:#A80036;stroke-width:2.0;" x1="903.5" x2="913.5" y1="1110.5313" y2="1120.5313"/><line style="stroke:#A80036;stroke-width:2.0;" x1="903.5" x2="913.5" y1="1120.5313" y2="1110.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="544.5" x2="908.5" y1="1115.5313" y2="1115.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="551.5" y="1108.4653">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="577.5" y="1108.4653">Disconnect</text><!--MD5=[9b7add3c3bdf387e36923e4f16924cdb]
@startuml
skinparam NoteTextAlignment left
skinparam Padding 2
skinparam ParticipantPadding 40
skinparam LifelineStrategy solid
autonumber

participant "FHIR Server\nREST API"     as S
participant "Client"                    as C
participant "FHIR Server\nWebsocket Endpoint" as E

group Subscription Negotiation
  C->S: Create Subscription\n""channelType: websocket""
  return Success\n""Subscription.status: active""
end

group Websocket Subscription Processing
else Client binds via initial token
  C->S: FHIR Operation:\n"".../Subscription/example/$get-ws-binding-token""
  return FHIR Parameters:\n""        token: token-abc""\n""   expiration: some-future-date-time""\n""websocket-url: wss://example.org/fhirWss""

  C->E: Connect\n""wss://example.org/fhirWss""

  C->E: ""bind-with-token: token-abc""
  return Bundle:\n""            Bundle.type: history""\n""SubscriptionStatus.type: handshake""

else Sever sends heartbeat
    E->C: Bundle:\n""            Bundle.type: history""\n""SubscriptionStatus.type: heartbeat""
    ...
else Server sends event-notification
    E->C: Bundle:\n""            Bundle.type: history""\n""SubscriptionStatus.type: event-notification""
    ...
else Token is expiring soon
    C->S: FHIR Operation:\n"".../Subscription/example/$get-ws-binding-token""
    return FHIR Parameters:\n""        token: token-def""\n""   expiration: another-future-date-time""\n""websocket-url: wss://example.org/fhirWss""

    C o->o E: Client checks the url and establishes\na new connection if necessary

    C->E: ""bind-with-token: token-def""
    return Bundle:\n""            Bundle.type: history""\n""SubscriptionStatus.type: handshake""
    ...
else Either system may end a session
  C x-x E: Disconnect
end

deactivate E
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>